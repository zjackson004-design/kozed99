<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Z99 Admin - Super Control</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #0f172a; font-family: 'Segoe UI', sans-serif; }
        .sidebar-link { display: flex; align-items: center; gap: 12px; padding: 12px 16px; color: #94a3b8; cursor: pointer; transition: 0.2s; border-radius: 8px; margin-bottom: 4px; }
        .sidebar-link:hover, .sidebar-link.active { background-color: #1e293b; color: #fbbf24; font-weight: bold; }
        .search-box { background: #1e293b; border: 1px solid #334155; padding: 8px; border-radius: 6px; color: white; width: 100%; outline: none; }
        .stat-card { background: #1e293b; border: 1px solid #334155; padding: 20px; border-radius: 12px; position: relative; overflow: hidden; }
        .modal { transition: opacity 0.2s; opacity: 0; pointer-events: none; }
        .modal.open { opacity: 1; pointer-events: auto; }
        #main-app.locked { filter: blur(10px); pointer-events: none; }
        th { font-size: 11px; text-transform: uppercase; color: #64748b; padding: 12px; }
        td { padding: 12px; border-top: 1px solid #1e293b; font-size: 13px; }
    </style>
</head>
<body class="text-gray-100 h-screen flex overflow-hidden">

    <div id="lock-screen" class="fixed inset-0 z-[100] bg-[#0f172a] flex flex-col items-center justify-center">
        <div class="bg-gray-800 p-8 rounded-2xl shadow-2xl w-96 text-center border border-gray-700">
            <h2 class="text-xl font-bold mb-4">RESTRICTED ACCESS</h2>
            <input type="password" id="admin-code" placeholder="Enter Secret Code" class="w-full bg-gray-900 border border-gray-600 rounded px-4 py-3 text-center text-white mb-4 outline-none">
            <button onclick="unlockAdmin()" class="w-full bg-yellow-500 hover:bg-yellow-400 text-black font-bold py-3 rounded">UNLOCK</button>
        </div>
    </div>

    <div id="main-app" class="flex w-full h-full locked">
        
        <aside class="w-64 bg-gray-900 border-r border-gray-800 flex flex-col p-4">
            <div class="flex items-center gap-3 mb-6 px-2"><img src="logo.png" class="h-10 w-auto"><span class="text-xl font-bold text-yellow-500">ADMIN</span></div>
            <nav class="flex-1 overflow-y-auto no-scrollbar">
                <div class="sidebar-link active" onclick="showPage('dashboard', this)"><i class="fas fa-chart-pie"></i> Dashboard</div>
                <div class="sidebar-link" onclick="showPage('users', this)"><i class="fas fa-users"></i> Users & P/L</div>
                <div class="sidebar-link" onclick="showPage('report', this)"><i class="fas fa-chart-line"></i> Daily Report</div>
                <div class="sidebar-link" onclick="showPage('banking', this)"><i class="fas fa-university"></i> Banking Requests <span id="req-badge" class="bg-red-600 text-white text-[10px] px-2 rounded-full hidden">New</span></div>
                <div class="sidebar-link" onclick="showPage('bets', this)"><i class="fas fa-ticket-alt"></i> Bet History</div>
                <div class="sidebar-link" onclick="showPage('transactions', this)"><i class="fas fa-exchange-alt"></i> Financial Log</div>
                <div class="sidebar-link" onclick="showPage('tools', this)"><i class="fas fa-tools"></i> System Tools</div>
                <div class="sidebar-link" onclick="showPage('logs', this)"><i class="fas fa-list"></i> Activity Logs</div>
                <div class="sidebar-link" onclick="showPage('settings', this)"><i class="fas fa-cog"></i> Settings</div>
            </nav>
            <button onclick="adminLogout()" class="bg-gray-800 text-gray-400 py-2 rounded hover:text-white mt-4 text-sm font-bold"><i class="fas fa-lock"></i> LOCK PANEL</button>
        </aside>

        <main class="flex-1 flex flex-col overflow-hidden bg-[#0f172a]">
            
            <header class="bg-gray-900 border-b border-gray-800 p-4 flex justify-between items-center shadow-lg z-10">
                <div class="flex items-center gap-4">
                    <h2 class="text-xl font-bold text-gray-200" id="page-title">Dashboard</h2>
                    <div id="maint-badge" class="hidden bg-red-600 text-white text-xs font-bold px-3 py-1 rounded animate-pulse">‚ö†Ô∏è MAINTENANCE ON</div>
                    <div class="bg-gray-800 border border-gray-700 px-4 py-1 rounded-full flex items-center gap-2">
                        <i class="far fa-clock text-yellow-500"></i>
                        <span id="mm-clock" class="text-sm font-mono font-bold text-green-400">Loading...</span>
                    </div>
                </div>
                <button onclick="loadAllData()" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded font-bold shadow flex items-center gap-2">
                    <i class="fas fa-sync-alt"></i> REFRESH ALL
                </button>
            </header>

            <div class="flex-1 overflow-y-auto p-8 relative">
                
                <div id="page-dashboard" class="page-content">
                    <div class="grid grid-cols-3 gap-6 mb-8">
                        <div class="stat-card"><div class="text-gray-400 text-xs font-bold uppercase">Total Players</div><div class="text-4xl font-bold mt-2" id="stat-users">0</div></div>
                        <div class="stat-card"><div class="text-gray-400 text-xs font-bold uppercase">Pending Bets</div><div class="text-4xl font-bold mt-2 text-yellow-400" id="stat-pending">0</div></div>
                        <div class="stat-card"><div class="text-gray-400 text-xs font-bold uppercase">Pending Requests</div><div class="text-4xl font-bold mt-2 text-blue-400" id="stat-requests">0</div></div>
                    </div>
                </div>

                <div id="page-users" class="page-content hidden">
                    <div class="flex justify-between items-center mb-4"><input type="text" id="user-search" placeholder="Search ID or Name..." class="search-box w-64" onkeyup="filterUsers()"></div>
                    <div class="bg-gray-800 rounded-xl overflow-hidden shadow-lg border border-gray-700"><table class="w-full text-left text-sm text-gray-300"><thead class="bg-gray-900"><tr><th>User ID / Name</th><th class="text-right">Balance</th><th class="text-right text-green-400">Total In</th><th class="text-right text-red-400">Total Out</th><th class="text-right text-blue-400">Profit (Site)</th><th class="text-center">Status</th><th class="text-right">Action</th></tr></thead><tbody id="user-list"></tbody></table></div>
                </div>

                <div id="page-report" class="page-content hidden">
                    <div class="flex justify-between items-center mb-6"><div class="flex items-center gap-4"><h2 class="text-2xl font-bold text-white">Financial Report</h2><input type="date" id="report-date" class="bg-gray-800 text-white border border-gray-600 p-2 rounded" onchange="loadReport()"></div></div>
                    <div class="grid grid-cols-3 gap-6 mb-8"><div class="stat-card border-green-900 bg-green-900/10"><div class="text-green-400 text-xs font-bold uppercase">TOTAL DEPOSIT (IN)</div><div class="text-3xl font-black mt-2 text-green-500" id="rep-in">0 MMK</div></div><div class="stat-card border-red-900 bg-red-900/10"><div class="text-red-400 text-xs font-bold uppercase">TOTAL WITHDRAW (OUT)</div><div class="text-3xl font-black mt-2 text-red-500" id="rep-out">0 MMK</div></div><div class="stat-card border-blue-900 bg-blue-900/10"><div class="text-blue-400 text-xs font-bold uppercase">NET PROFIT</div><div class="text-3xl font-black mt-2 text-blue-500" id="rep-net">0 MMK</div></div></div>
                    <div class="bg-gray-800 rounded-xl overflow-hidden shadow-lg border border-gray-700"><table class="w-full text-left text-sm text-gray-300"><thead class="bg-gray-900"><tr><th class="p-4">Time</th><th class="p-4">User</th><th class="p-4">Type</th><th class="p-4 text-right">Amount</th></tr></thead><tbody id="report-list" class="divide-y divide-gray-700"></tbody></table></div>
                </div>

                <div id="page-banking" class="page-content hidden"><div class="bg-gray-800 rounded-xl overflow-hidden shadow-lg border border-gray-700"><table class="w-full text-left text-sm text-gray-300"><thead class="bg-gray-900"><tr><th class="p-4">User</th><th class="p-4">Type</th><th class="p-4">Details</th><th class="p-4 text-right">Amount</th><th class="p-4 text-right">Action</th></tr></thead><tbody id="request-list" class="divide-y divide-gray-700"></tbody></table></div></div>
                <div id="page-bets" class="page-content hidden"><div class="bg-gray-800 rounded-xl overflow-hidden shadow-lg border border-gray-700" id="bet-list"></div></div>
                <div id="page-transactions" class="page-content hidden"><div class="bg-gray-800 rounded-xl overflow-hidden shadow-lg border border-gray-700"><table class="w-full text-left text-sm text-gray-300"><thead class="bg-gray-900"><tr><th class="p-4">Time</th><th class="p-4">User</th><th class="p-4">Details</th><th class="p-4 text-right">Amount</th></tr></thead><tbody id="trx-list" class="divide-y divide-gray-700"></tbody></table></div></div>
                <div id="page-logs" class="page-content hidden"><div class="bg-gray-800 rounded-xl overflow-hidden shadow-lg border border-gray-700"><table class="w-full text-left text-sm text-gray-300"><thead class="bg-gray-900"><tr><th class="p-4">Time</th><th class="p-4">Admin</th><th class="p-4">Action</th><th class="p-4">Details</th></tr></thead><tbody id="log-list"></tbody></table></div></div>
                <div id="page-tools" class="page-content hidden"><div class="grid grid-cols-2 gap-6"><div class="bg-red-900/20 border border-red-900 p-6 rounded-xl"><h3 class="text-xl font-bold text-red-500 mb-2"><i class="fas fa-power-off"></i> EMERGENCY</h3><button onclick="toggleMaintenance(true)" class="bg-red-600 text-white px-4 py-2 rounded font-bold mr-2">üî¥ BLOCK</button><button onclick="toggleMaintenance(false)" class="bg-green-600 text-white px-4 py-2 rounded font-bold">üü¢ LIVE</button></div><div class="bg-blue-900/20 border border-blue-900 p-6 rounded-xl"><h3 class="text-xl font-bold text-blue-500 mb-2"><i class="fas fa-bell"></i> NOTIFICATION</h3><input type="text" id="notify-msg" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white mb-2" placeholder="Message..."><button onclick="sendNotification()" class="bg-blue-600 text-white px-4 py-2 rounded font-bold">SEND</button></div></div></div>

                <div id="page-settings" class="page-content hidden">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                            <label class="text-sm font-bold text-gray-400 block mb-2">Announcement</label>
                            <textarea id="ann-input" class="w-full bg-gray-900 border border-gray-600 rounded p-3 text-white outline-none"></textarea>
                            <label class="text-sm font-bold text-blue-400 block mt-4 mb-2">Slider Images</label>
                            <input type="text" id="banner-1" class="search-box mb-2" placeholder="Image 1">
                            <input type="text" id="banner-2" class="search-box mb-2" placeholder="Image 2">
                            <input type="text" id="banner-3" class="search-box" placeholder="Image 3">
                        </div>
                        <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                            <label class="text-sm font-bold text-red-400 block mb-2">Risk Limits</label>
                            <input type="number" id="limit-stake" class="search-box mb-4" placeholder="Max Stake">
                            <input type="number" id="limit-win" class="search-box mb-4" placeholder="Max Win">
                            <div class="border-t border-gray-700 my-4"></div>
                            <label class="text-sm font-bold text-yellow-400 block mb-2">Invite Code</label>
                            <input type="text" id="invite-code-input" class="search-box border-yellow-600 text-yellow-400 font-bold" placeholder="e.g. 8888">
                        </div>
                    </div>
                    <button onclick="saveSettings()" class="mt-6 bg-yellow-500 text-black font-bold px-8 py-3 rounded shadow hover:bg-yellow-400 transition">SAVE SETTINGS</button>
                </div>

            </div>
        </main>
    </div>

    <div id="user-detail-modal" class="modal fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"><div class="bg-gray-900 w-full max-w-4xl rounded-xl border border-gray-700 p-6 shadow-2xl h-[90vh] flex flex-col"><div class="flex justify-between items-center mb-6 border-b border-gray-800 pb-4"><div><h2 class="text-2xl font-bold text-white"><i class="fas fa-user-circle"></i> <span id="detail-username">User</span></h2><p class="text-xs text-gray-500 font-mono mt-1">ID: <span id="detail-id">...</span></p></div><button onclick="closeDetailModal()" class="text-gray-400 hover:text-white text-2xl"><i class="fas fa-times"></i></button></div><div class="grid grid-cols-4 gap-4 mb-6"><div class="bg-gray-800 p-4 rounded-lg border border-gray-700"><div class="text-xs text-gray-500 font-bold">BALANCE</div><div class="text-xl font-bold text-yellow-400" id="detail-bal">0</div></div><div class="bg-gray-800 p-4 rounded-lg border border-gray-700"><div class="text-xs text-gray-500 font-bold">TOTAL DEPOSIT</div><div class="text-xl font-bold text-green-400" id="detail-dep">0</div></div><div class="bg-gray-800 p-4 rounded-lg border border-gray-700"><div class="text-xs text-gray-500 font-bold">TOTAL WITHDRAW</div><div class="text-xl font-bold text-red-400" id="detail-with">0</div></div><div class="bg-gray-800 p-4 rounded-lg border border-gray-700"><div class="text-xs text-gray-500 font-bold">SITE PROFIT</div><div class="text-xl font-bold text-blue-400" id="detail-net">0</div></div></div><div class="flex gap-2 mb-6"><button onclick="openMoneyModal()" class="bg-green-700 hover:bg-green-600 text-white px-4 py-2 rounded text-sm font-bold flex-1"><i class="fas fa-money-bill-wave"></i> BALANCE</button><button onclick="adminResetPass()" class="bg-yellow-600 hover:bg-yellow-500 text-white px-4 py-2 rounded text-sm font-bold flex-1"><i class="fas fa-key"></i> PASSWORD</button><button id="detail-ban-btn" onclick="toggleBanFromDetail()" class="bg-red-900/50 hover:bg-red-900 text-red-400 border border-red-800 px-4 py-2 rounded text-sm font-bold flex-1"><i class="fas fa-ban"></i> BLOCK</button></div><div class="flex-1 overflow-hidden bg-gray-800 rounded-xl border border-gray-700 flex flex-col"><div class="bg-gray-900 p-2"><span class="text-xs font-bold text-gray-400">BET HISTORY</span></div><div class="flex-1 overflow-y-auto p-2" id="detail-bet-list"></div></div></div></div>
    <div id="money-modal" class="modal fixed inset-0 z-[60] flex items-center justify-center bg-black/90"><div class="bg-gray-800 p-6 rounded-xl border border-gray-600 w-80"><h3 class="font-bold text-white mb-4">Adjust Balance</h3><input type="number" id="adjust-amount" class="search-box mb-4" placeholder="Amount"><div class="grid grid-cols-2 gap-2"><button onclick="submitAdjustment('add')" class="bg-green-600 text-white py-2 rounded font-bold">ADD</button><button onclick="submitAdjustment('deduct')" class="bg-red-600 text-white py-2 rounded font-bold">DEDUCT</button></div><button onclick="document.getElementById('money-modal').classList.remove('open')" class="mt-4 text-xs text-gray-400 w-full text-center">Cancel</button></div></div>

    <script>
        const API_BASE = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' || window.location.hostname.startsWith('192.168.') ? 'http://' + window.location.host : window.location.origin;
        let allUsers = [], allBets = [], allTransactions = [], selectedUser = null;

        function updateMyanmarTime() { const now = new Date(); const options = { timeZone: 'Asia/Yangon', hour12: true, hour: 'numeric', minute: 'numeric', second: 'numeric', weekday: 'short', day: 'numeric', month: 'short' }; document.getElementById('mm-clock').innerText = new Intl.DateTimeFormat('en-US', options).format(now); }
        setInterval(updateMyanmarTime, 1000); updateMyanmarTime();

        if (sessionStorage.getItem('z99_admin_logged_in') === 'true') { document.getElementById('lock-screen').style.display = 'none'; document.getElementById('main-app').classList.remove('locked'); loadAllData(); }
        async function unlockAdmin() { const code = document.getElementById('admin-code').value; try { const res = await fetch(`${API_BASE}/admin/login`, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ code }) }); if ((await res.json()).success) { sessionStorage.setItem('z99_admin_logged_in', 'true'); document.getElementById('lock-screen').style.display = 'none'; document.getElementById('main-app').classList.remove('locked'); loadAllData(); } else alert("Wrong Code"); } catch (e) { alert("Server Error"); } }
        function adminLogout() { sessionStorage.removeItem('z99_admin_logged_in'); window.location.reload(); }
        function showPage(pageId, btn) { document.querySelectorAll('.page-content').forEach(el => el.classList.add('hidden')); document.getElementById('page-' + pageId).classList.remove('hidden'); document.querySelectorAll('.sidebar-link').forEach(el => el.classList.remove('active')); btn.classList.add('active'); document.getElementById('page-title').innerText = btn.innerText; if(pageId === 'report') loadReport(); }
        function loadAllData() { loadDashboard(); loadRequests(); loadTransactions(); loadReport(); loadLogs(); }

        async function loadDashboard() { try { const res = await fetch(`${API_BASE}/admin/data`); const db = await res.json(); allUsers = []; allBets = []; const userList = document.getElementById('user-list'); userList.innerHTML = ''; let userCount = 0, pendingCount = 0; for (const [username, data] of Object.entries(db)) { userCount++; let totalIn = 0, totalOut = 0; if(data.transactions) { data.transactions.forEach(t => { const amt = parseInt(t.amount.replace(/[^0-9-]/g, '')); if(t.amount.includes('+') && t.status === 'Success' && !t.title.includes('Win')) totalIn += amt; if(t.amount.includes('-') && t.status === 'Success' && !t.title.includes('Bet')) totalOut += Math.abs(amt); }); } data.username = username; data.totalIn = totalIn; data.totalOut = totalOut; allUsers.push(data); const statusHtml = data.isBanned ? '<span class="text-red-500 font-bold text-xs">BANNED</span>' : '<span class="text-green-500 font-bold text-xs">ACTIVE</span>'; const shortID = data.id ? data.id.substring(data.id.length - 6) : '...'; const net = totalIn - totalOut; const netColor = net >= 0 ? 'text-blue-400' : 'text-red-400'; userList.innerHTML += `<tr class="hover:bg-gray-700/50 border-b border-gray-700"><td class="p-4"><div class="font-bold text-white">${username}</div><div class="text-xs text-gray-500 font-mono">ID: ...${shortID}</div></td><td class="p-4 text-right font-bold text-yellow-400">${data.balance.toLocaleString()}</td><td class="p-4 text-right font-bold text-green-500">${totalIn.toLocaleString()}</td><td class="p-4 text-right font-bold text-red-500">${totalOut.toLocaleString()}</td><td class="p-4 text-right font-bold ${netColor}">${net.toLocaleString()}</td><td class="p-4 text-center">${statusHtml}</td><td class="p-4 text-right"><button onclick="openDetailModal('${username}')" class="bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded text-xs font-bold text-white shadow">View</button></td></tr>`; data.history.forEach(t => { allBets.push({ ...t, username }); if(t.status === 'Pending') pendingCount++; }); } document.getElementById('stat-users').innerText = userCount; document.getElementById('stat-pending').innerText = pendingCount; renderBets(allBets); } catch (err) { console.error(err); } }
        function openDetailModal(username) { const user = allUsers.find(u => u.username === username); if(!user) return; selectedUser = user; document.getElementById('detail-username').innerText = user.username; document.getElementById('detail-id').innerText = user.id || "N/A"; document.getElementById('detail-bal').innerText = user.balance.toLocaleString(); document.getElementById('detail-dep').innerText = user.totalIn.toLocaleString(); document.getElementById('detail-with').innerText = user.totalOut.toLocaleString(); document.getElementById('detail-net').innerText = (user.totalIn - user.totalOut).toLocaleString(); const banBtn = document.getElementById('detail-ban-btn'); banBtn.innerHTML = user.isBanned ? '<i class="fas fa-check"></i> UNBAN' : '<i class="fas fa-ban"></i> BLOCK'; const list = document.getElementById('detail-bet-list'); list.innerHTML = ''; if(user.history.length === 0) list.innerHTML = '<div class="text-center text-gray-500 p-4">No bets found</div>'; [...user.history].reverse().forEach(t => { const statusColor = t.status === 'Pending' ? 'text-yellow-400' : (t.status === 'Won' ? 'text-green-400' : 'text-red-400'); const matches = Array.isArray(t.matches) ? t.matches.map(m => `<div class="flex justify-between text-xs text-gray-400"><span>${m.title}</span><span class="text-blue-300">${m.selection}</span></div>`).join('') : ''; list.innerHTML += `<div class="bg-gray-900 p-3 rounded border border-gray-700 mb-2"><div class="flex justify-between mb-2"><span class="text-xs text-gray-500">${t.date}</span><span class="text-xs font-bold ${statusColor}">${t.status}</span></div><div class="mb-2 space-y-1">${matches}</div><div class="flex justify-between border-t border-gray-800 pt-2 text-sm"><span class="text-gray-400">Stake: ${t.stake}</span><span class="text-white font-bold">Win: ${t.win}</span></div></div>`; }); document.getElementById('user-detail-modal').classList.add('open'); }
        function closeDetailModal() { document.getElementById('user-detail-modal').classList.remove('open'); }
        function openMoneyModal() { document.getElementById('money-modal').classList.add('open'); }
        async function submitAdjustment(action) { const amt = document.getElementById('adjust-amount').value; if(!amt || !selectedUser) return; await fetch(`${API_BASE}/admin/balance`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ username: selectedUser.username, amount: amt, action }) }); document.getElementById('money-modal').classList.remove('open'); closeDetailModal(); loadAllData(); }
        async function toggleBanFromDetail() { if(!selectedUser) return; await fetch(`${API_BASE}/admin/ban`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ username: selectedUser.username, status: !selectedUser.isBanned }) }); closeDetailModal(); loadAllData(); }
        async function adminResetPass() { if(!selectedUser) return; const newPass = prompt(`Enter NEW Password for ${selectedUser.username}:`); if (newPass) { await fetch(`${API_BASE}/admin/reset-password`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ username: selectedUser.username, newPassword: newPass }) }); alert("‚úÖ Password Updated!"); } }
        
        async function loadRequests() { try { const res = await fetch(`${API_BASE}/admin/requests`); const data = await res.json(); document.getElementById('stat-requests').innerText = data.length; const list = document.getElementById('request-list'); list.innerHTML = ''; if(data.length === 0) { list.innerHTML = '<tr><td colspan="5" class="p-8 text-center text-gray-500">No pending requests</td></tr>'; document.getElementById('req-badge').classList.add('hidden'); return; } document.getElementById('req-badge').classList.remove('hidden'); data.forEach(r => { const color = r.type === 'Deposit' ? 'text-green-400' : 'text-red-400'; const details = r.paymentId ? `<div class="text-xs text-gray-400">ID: ${r.paymentId} | Name: ${r.accountName}</div>` : ''; list.innerHTML += `<tr class="border-b border-gray-700 hover:bg-gray-800"><td class="p-4 font-bold text-white">${r.username}</td><td class="p-4 font-bold ${color}">${r.type}</td><td class="p-4">${details}</td><td class="p-4 text-right font-bold text-white">${r.amount.toLocaleString()}</td><td class="p-4 text-right"><button onclick="process('${r._id}', 'Approve')" class="bg-green-600 text-white px-2 py-1 rounded mr-2">‚úî</button><button onclick="process('${r._id}', 'Reject')" class="bg-red-600 text-white px-2 py-1 rounded">‚úñ</button></td></tr>`; }); } catch(e) {} }
        async function process(id, action) { if(!confirm(action + "?")) return; await fetch(`${API_BASE}/admin/approve-request`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ id, action }) }); loadAllData(); }
        
        async function loadTransactions() { try { const res = await fetch(`${API_BASE}/admin/transactions`); const data = await res.json(); allTransactions = data; renderTransactions(data); } catch(e) {} }
        function renderTransactions(data) { const list = document.getElementById('trx-list'); list.innerHTML = ''; if(data.length === 0) { list.innerHTML = '<tr><td colspan="5" class="p-8 text-center text-gray-500">No transactions log</td></tr>'; return; } data.forEach(t => { const color = t.color === 'green' ? 'text-green-400' : 'text-red-400'; const detailText = t.details || '-'; list.innerHTML += `<tr class="border-b border-gray-800 hover:bg-gray-800"><td class="p-4 text-gray-400 text-xs">${t.date}</td><td class="p-4 font-bold text-white">${t.username}</td><td class="p-4 text-gray-300 font-bold">${t.type || t.title}</td><td class="p-4 text-xs text-gray-400">${detailText}</td><td class="p-4 text-right font-bold ${color}">${t.amount}</td></tr>`; }); }
        function filterTransactions() { const search = document.getElementById('trans-search').value.toLowerCase(); const date = document.getElementById('trans-date').value; const filtered = allTransactions.filter(t => { const matchesSearch = t.username.toLowerCase().includes(search) || (t.type && t.type.toLowerCase().includes(search)); const matchesDate = date ? t.date.includes(new Date(date).toLocaleDateString()) : true; return matchesSearch && matchesDate; }); renderTransactions(filtered); }
        function renderBets(bets) { const list = document.getElementById('bet-list'); list.innerHTML = ''; if (bets.length === 0) { list.innerHTML = '<div class="p-8 text-center text-gray-500">No data found</div>'; return; } bets.sort((a, b) => new Date(b.date) - new Date(a.date)); bets.forEach(t => { const statusColor = t.status === 'Pending' ? 'text-yellow-400' : (t.status === 'Won' ? 'text-green-400' : 'text-red-400'); const matchCount = Array.isArray(t.matches) ? t.matches.length : t.matches; let actionBtns = ''; if(t.status === 'Pending') { actionBtns = `<div class="flex gap-2"><button onclick="settle('${t.username}', '${t.id}', 'Won')" class="bg-green-600 px-3 py-1 rounded text-xs font-bold">WIN</button><button onclick="settle('${t.username}', '${t.id}', 'Lost')" class="bg-red-600 px-3 py-1 rounded text-xs font-bold">LOSS</button></div>`; } else { actionBtns = `<span class="text-xs font-bold uppercase border border-gray-600 px-3 py-1 rounded">${t.status}</span>`; } list.innerHTML += `<div class="p-4 flex items-center justify-between border-b border-gray-700 hover:bg-gray-700/50"><div><div class="font-bold text-blue-400 text-sm flex gap-2 items-center"><span>${t.id}</span> <span class="bg-gray-700 text-gray-300 px-2 rounded text-[10px] uppercase">${t.username}</span></div><div class="text-xs text-gray-500 mt-1">${matchCount} Matches ‚Ä¢ ${t.date}</div><div class="font-bold ${statusColor} mt-1">${t.win} <span class="text-gray-500 text-[10px] ml-2">(Stake: ${t.stake})</span></div></div>${actionBtns}</div>`; }); }
        function filterBets() { const search = document.getElementById('bet-search').value.toLowerCase(); const date = document.getElementById('bet-date').value; const filtered = allBets.filter(t => { const matchesSearch = t.id.toLowerCase().includes(search) || t.username.toLowerCase().includes(search); const matchesDate = date ? t.date.includes(new Date(date).toLocaleDateString()) : true; return matchesSearch && matchesDate; }); renderBets(filtered); }
        async function settle(u, t, o) { if(!confirm("Confirm?")) return; await fetch(`${API_BASE}/admin/settle`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ userId: u, ticketId: t, outcome: o }) }); loadAllData(); }
        async function loadReport() { const dateInput = document.getElementById('report-date').value; try { const url = dateInput ? `${API_BASE}/admin/report?date=${dateInput}` : `${API_BASE}/admin/report`; const res = await fetch(url); const data = await res.json(); document.getElementById('rep-in').innerText = data.deposit.toLocaleString() + " MMK"; document.getElementById('rep-out').innerText = data.withdraw.toLocaleString() + " MMK"; const net = data.net; const netEl = document.getElementById('rep-net'); netEl.innerText = (net > 0 ? "+" : "") + net.toLocaleString() + " MMK"; netEl.className = `text-3xl font-black mt-2 ${net >= 0 ? 'text-blue-500' : 'text-red-500'}`; const list = document.getElementById('report-list'); list.innerHTML = ''; if(data.transactions.length === 0) { list.innerHTML = '<tr><td colspan="4" class="p-8 text-center text-gray-500">No transactions for this date</td></tr>'; return; } data.transactions.forEach(t => { const color = t.type === 'Deposit' ? 'text-green-400' : 'text-red-400'; list.innerHTML += `<tr class="border-b border-gray-800 hover:bg-gray-800/50"><td class="p-4 text-gray-400 text-xs">${t.date}</td><td class="p-4 font-bold text-white">${t.username}</td><td class="p-4 font-bold ${color}">${t.type}</td><td class="p-4 text-right font-bold text-white">${t.amount.toLocaleString()}</td></tr>`; }); } catch(e) { console.error("Report Error", e); } }
        async function toggleMaintenance(status) { if(!confirm(status ? "‚õî SHUTDOWN SITE?" : "‚úÖ GO LIVE?")) return; await fetch(`${API_BASE}/admin/maintenance`, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ status: status.toString() }) }); alert(status ? "Site Locked!" : "Site Online!"); if(status) document.getElementById('maint-badge').classList.remove('hidden'); else document.getElementById('maint-badge').classList.add('hidden'); }
        async function sendNotification() { const msg = document.getElementById('notify-msg').value; if(!msg) return; await fetch(`${API_BASE}/admin/notify`, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ message: msg }) }); alert("Notification Sent!"); }
        async function loadLogs() { const res = await fetch(`${API_BASE}/admin/logs`); const logs = await res.json(); const list = document.getElementById('log-list'); list.innerHTML = ''; logs.forEach(l => { list.innerHTML += `<tr class="border-b border-gray-800"><td class="p-4 text-gray-400 text-xs">${l.date}</td><td class="p-4 font-bold text-white">${l.admin}</td><td class="p-4 text-yellow-400">${l.action}</td><td class="p-4 text-gray-300 text-xs">${l.details}</td></tr>`; }); }
        async function saveSettings() { const announcement = document.getElementById('ann-input').value; const maxStake = document.getElementById('limit-stake').value; const maxWin = document.getElementById('limit-win').value; const inviteCode = document.getElementById('invite-code-input').value; const banner1 = document.getElementById('banner-1').value; const banner2 = document.getElementById('banner-2').value; const banner3 = document.getElementById('banner-3').value; try { await fetch(`${API_BASE}/admin/config`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ announcement, maxStake, maxWin, inviteCode, banner1, banner2, banner3 }) }); alert("‚úÖ Settings Saved!"); } catch(e) { alert("Error saving settings"); } }
        async function loadSettings() { try { const res = await fetch(`${API_BASE}/api/config`); const data = await res.json(); if(document.getElementById('ann-input')) document.getElementById('ann-input').value = data.announcement || ""; if(document.getElementById('limit-stake')) document.getElementById('limit-stake').value = data.maxStake || 100000; if(document.getElementById('limit-win')) document.getElementById('limit-win').value = data.maxWin || 5000000; if(document.getElementById('invite-code-input')) document.getElementById('invite-code-input').value = data.inviteCode || "8888"; if(document.getElementById('banner-1')) document.getElementById('banner-1').value = data.banner1 || ""; if(document.getElementById('banner-2')) document.getElementById('banner-2').value = data.banner2 || ""; if(document.getElementById('banner-3')) document.getElementById('banner-3').value = data.banner3 || ""; } catch(e) {} }
    </script>
</body>
</html>